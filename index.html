<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>APOLLO 2.4</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      background: url('https://i.pinimg.com/736x/01/22/d9/0122d95177d733f1dabd36acca11fef5.jpg') no-repeat center center fixed;
      background-size: cover;
      position: relative;
    }

    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 105%;
      background-color: rgba(255, 255, 255, 0.4); /* Opacidade de 80% */
    }

    .container {
      margin-top: 0px;
      position: relative;
      z-index: 1; /* Garante que o conteúdo da página fique na frente do fundo abstrato */
    }
  </style>
</head>
<body>
  <div class="overlay"></div>

  <div class="container">
    <h2>APOLLO_LINO</h2>
    <div class="form-group">
      <label for="productName">Produto:</label>
      <input type="text" class="form-control" id="productName" maxlength="30">
    </div>
    <div class="form-group">
      <label for="productPerimeter">Perímetro:</label>
      <input type="number" class="form-control" id="productPerimeter" step="any">
    </div>
    <div class="form-group">
      <label for="productCut">Corte:</label>
      <input type="number" class="form-control" id="productCut" step="any">
    </div>
    <div class="form-group">
      <label for="productRepetition">Repetição:</label>
      <input type="number" class="form-control" id="productRepetition" step="0.001" min="0">
    </div>
    <div class="form-group">
      <label for="productChagrin">Chagrim:</label>
      <select class="form-control" id="productChagrin">
        <option value="sim">Sim</option>
        <option value="nao">Não</option>
      </select>
    </div>
    <div class="form-group">
      <label for="productSpeed">Vel:</label>
      <input type="number" class="form-control" id="productSpeed" step="0.001" min="0">
    </div>
    <div class="form-group">
      <label for="productImage">Imagem do Produto:</label>
      <input type="file" class="form-control-file" id="productImage" accept="image/*">
    </div>
    <div class="form-group">
      <label for="productComments">Comentário:</label>
      <input type="text" class="form-control" id="productComments" maxlength="200">
    </div>
    <button type="button" class="btn btn-primary" onclick="saveProduct()">Salvar</button>
  </div>

  <div class="container mt-5">
    <h2>Histórico</h2>
    <div class="form-group">
      <!--label for="productSelect">Selecionar Produto:</label-->
      <select class="form-control" id="productSelect" onchange="showSelectedProduct()">
        <option value="">Selecione um produto</option>
      </select>
    </div>
    <button type="button" class="btn btn-danger" onclick="removeSelectedProduct()">Remover</button>
  </div>

  <div class="container mt-3">
    <div id="selectedProductDetails"></div>
  </div>

<script>
  function saveProduct() {
    var productName = document.getElementById("productName").value.trim().toUpperCase();
    var productPerimeter = document.getElementById("productPerimeter").value.trim();
    var productCut = document.getElementById("productCut").value.trim();
    var productRepetition = document.getElementById("productRepetition").value.trim();
    var productChagrin = document.getElementById("productChagrin").value.trim();
    var productSpeed = document.getElementById("productSpeed").value.trim(); // Obtendo valor da velocidade
    var productComments = document.getElementById("productComments").value.trim();
    var productImageInput = document.getElementById("productImage");
    var currentDate = new Date();
    var formattedDate = currentDate.toLocaleDateString('pt-BR') + ' ' + currentDate.toLocaleTimeString('pt-BR');

    if (productName === "") {
      alert("Por favor, insira o nome do produto.");
      return;
    }

    if (isNaN(productPerimeter)) {
      alert("O perímetro do produto deve ser um número.");
      return;
    }

    if (isNaN(productCut)) {
      alert("O corte do perímetro deve ser um número.");
      return;
    }

    if (isNaN(productRepetition)) {
      alert("A repetição deve ser um número com até 3 casas decimais.");
      return;
    }

    if (isNaN(productSpeed)) {
      alert("A velocidade deve ser um número com até 3 casas decimais.");
      return;
    }

    var products = JSON.parse(localStorage.getItem("products")) || [];
    var existingProductIndex = products.findIndex(function(product) {
      return product.name === productName && product.perimeter === parseFloat(productPerimeter);
    });

    if (productImageInput.files && productImageInput.files[0]) {
      var reader = new FileReader();
      reader.onload = function(e) {
        var newImage = e.target.result;
        saveProductData(newImage);
      };
      reader.readAsDataURL(productImageInput.files[0]);
    } else {
      var existingImage = existingProductIndex !== -1 ? products[existingProductIndex].image : null;
      saveProductData(existingImage);
    }

    function saveProductData(newImage) {
      if (existingProductIndex !== -1) {
        products[existingProductIndex].cut = parseFloat(productCut);
        products[existingProductIndex].repetition = parseFloat(productRepetition);
        products[existingProductIndex].chagrin = productChagrin;
        products[existingProductIndex].speed = parseFloat(productSpeed);
        products[existingProductIndex].image = newImage || products[existingProductIndex].image;
        if (!products[existingProductIndex].comments) {
          products[existingProductIndex].comments = [];
        }
        products[existingProductIndex].comments.push({ text: productComments, date: formattedDate });
      } else {
        products.push({
          name: productName,
          perimeter: parseFloat(productPerimeter),
          cut: parseFloat(productCut),
          repetition: parseFloat(productRepetition),
          chagrin: productChagrin,
          speed: parseFloat(productSpeed),
          comments: [{ text: productComments, date: formattedDate }],
          image: newImage,
          created_at: new Date()
        });
      }

      localStorage.setItem("products", JSON.stringify(products));
      loadProducts();

      document.getElementById("productName").value = "";
      document.getElementById("productPerimeter").value = "";
      document.getElementById("productCut").value = "";
      document.getElementById("productRepetition").value = "";
      document.getElementById("productChagrin").value = "";
      document.getElementById("productSpeed").value = ""; // Limpando campo de velocidade
      document.getElementById("productComments").value = "";
      document.getElementById("productImage").value = "";

      alert("Produto salvo com sucesso!");
    }
  }
</script>

</body>
</html>
